/* ===== Tailwind v4 ===== */
@import 'tailwindcss';

/* Dark variant dựa trên [data-theme="dark"] ở <html> hoặc <body> */
@custom-variant dark (&:where([data-theme=dark], [data-theme=dark] *));

/* ===== Design Tokens (Tailwind đọc các biến này) ===== */
@theme inline {
  --font-sans:
    Geist, ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji',
    'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  --font-mono:
    Geist Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
    'Liberation Mono', 'Courier New', monospace;

  --color-background: var(--background);
  --color-foreground: var(--foreground);

  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);

  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);

  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);

  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);

  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);

  --color-additive: var(--additive);
  --color-additive-foreground: var(--additive-foreground);

  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);

  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
}

/* ===== Fonts ===== */
@font-face {
  font-family: 'Geist';
  src: url('/fonts/GeistVF.woff2') format('woff2-variations');
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'Geist Mono';
  src: url('/fonts/GeistMonoVF.woff2') format('woff2-variations');
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

/* =======================================================
   PALETTE – Light (shadcn/ui inspired)
   ======================================================= */
:root {
  --radius: 0.5rem;

  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);

  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);

  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);

  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);

  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);

  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);

  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);

  --additive: oklch(0.92 0.07 245);
  --additive-foreground: oklch(0.22 0.03 245);

  --destructive: oklch(0.577 0.245 27.325);
  --destructive-foreground: oklch(0.985 0 0);

  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);

  --chart-1: oklch(0.205 0 0);
  --chart-2: oklch(0.556 0 0);
  --chart-3: oklch(0.708 0 0);
  --chart-4: oklch(0.85 0 0);
  --chart-5: oklch(0.922 0 0);
}

/* =======================================================
   PALETTE – Dark (sáng hơn một tí, giống flocto's blog)
   ======================================================= */
[data-theme='dark'] {
  --background: oklch(0.18 0 0);      /* sáng hơn từ 0.145 -> 0.18 */
  --foreground: oklch(0.95 0 0);      /* nhẹ hơn từ 0.985 -> 0.95 */

  --card: oklch(0.22 0 0);            /* sáng hơn từ 0.205 -> 0.22 */
  --card-foreground: oklch(0.95 0 0);

  --popover: oklch(0.22 0 0);
  --popover-foreground: oklch(0.95 0 0);

  --primary: oklch(0.75 0.12 265);     /* màu xanh tím nhạt cho links */
  --primary-foreground: oklch(0.18 0 0);

  --secondary: oklch(0.25 0 0);       /* sáng hơn từ 0.205 -> 0.25 */
  --secondary-foreground: oklch(0.95 0 0);

  --muted: oklch(0.25 0 0);           /* sáng hơn từ 0.205 -> 0.25 */
  --muted-foreground: oklch(0.65 0 0); /* sáng hơn từ 0.556 -> 0.65 */

  --accent: oklch(0.25 0 0);          /* sáng hơn từ 0.205 -> 0.25 */
  --accent-foreground: oklch(0.95 0 0);

  --additive: oklch(0.34 0.05 245);
  --additive-foreground: oklch(0.94 0.01 245);

  --destructive: oklch(0.577 0.245 27.325);
  --destructive-foreground: oklch(0.95 0 0);

  --border: oklch(0.28 0 0);          /* sáng hơn từ 0.205 -> 0.28 */
  --input: oklch(0.25 0 0);           /* sáng hơn từ 0.205 -> 0.25 */
  --ring: oklch(0.708 0 0);

  --chart-1: oklch(0.95 0 0);
  --chart-2: oklch(0.65 0 0);
  --chart-3: oklch(0.708 0 0);
  --chart-4: oklch(0.85 0 0);
  --chart-5: oklch(0.922 0 0);
}

/* ===== Base resets & typography ===== */
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    @apply border-border outline-ring/50 tracking-tight;
  }

  html, body {
    @apply bg-background text-foreground;
    font-family: var(--font-sans);
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  body {
    background: 
      radial-gradient(circle at 20% 80%, color-mix(in oklch, var(--primary) 2%, transparent) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, color-mix(in oklch, var(--accent-foreground) 1.5%, transparent) 0%, transparent 50%),
      radial-gradient(circle at 40% 40%, color-mix(in oklch, var(--additive) 1%, transparent) 0%, transparent 50%);
    background-size: 800px 800px, 600px 600px, 400px 400px;
  }

  .prose {
    --tw-prose-body: var(--foreground);
    --tw-prose-headings: var(--foreground);
    --tw-prose-links: var(--primary);
    --tw-prose-bold: var(--foreground);
    --tw-prose-quotes: var(--muted-foreground);
    --tw-prose-code: var(--foreground);
    --tw-prose-counters: var(--muted-foreground);
    --tw-prose-bullets: var(--muted-foreground);
    --tw-prose-hr: var(--border);
    --tw-prose-th-borders: var(--border);
    --tw-prose-td-borders: var(--border);
  }
}

/* ===== Components & utilities (shadcn/ui inspired) ===== */
@layer components {
  /* Card hover effects với gradient border */
  .card-hover {
    transition: all 200ms ease;
    position: relative;
    background: linear-gradient(135deg, 
      color-mix(in oklch, var(--card) 98%, var(--primary) 2%),
      color-mix(in oklch, var(--card) 99%, var(--accent-foreground) 1%)
    );
  }
  .card-hover::before {
    content: '';
    position: absolute;
    inset: 0;
    padding: 1px;
    background: linear-gradient(135deg, 
      color-mix(in oklch, var(--primary) 20%, transparent),
      color-mix(in oklch, var(--accent-foreground) 15%, transparent)
    );
    border-radius: inherit;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    opacity: 0;
    transition: opacity 200ms ease;
  }
  .card-hover:hover {
    transform: translateY(-2px);
    box-shadow: 
      0 4px 15px -2px color-mix(in oklch, var(--foreground) 6%, transparent),
      0 8px 25px -4px color-mix(in oklch, var(--foreground) 3%, transparent);
  }
  .card-hover:hover::before {
    opacity: 1;
  }
  .card-hover:active {
    transform: translateY(-1px);
  }

  /* Modern button styles */
  .btn-primary {
    @apply bg-primary text-primary-foreground hover:bg-primary/90;
    @apply inline-flex items-center justify-center rounded-md text-sm font-medium;
    @apply transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring;
    @apply disabled:pointer-events-none disabled:opacity-50;
  }

  .btn-secondary {
    @apply bg-secondary text-secondary-foreground hover:bg-secondary/80;
    @apply inline-flex items-center justify-center rounded-md text-sm font-medium;
    @apply transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring;
    @apply disabled:pointer-events-none disabled:opacity-50;
  }

  /* Modern input styles */
  .input-modern {
    @apply flex h-10 w-full rounded-md border border-border bg-background px-3 py-2 text-sm;
    @apply ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium;
    @apply placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2;
    @apply focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50;
  }

  /* Glass morphism effect */
  .glass {
    background: color-mix(in oklch, var(--background) 80%, transparent);
    backdrop-filter: blur(12px);
    border: 1px solid color-mix(in oklch, var(--border) 50%, transparent);
  }

  /* Gradient text */
  .gradient-text {
    background: linear-gradient(135deg, var(--primary), var(--accent-foreground));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Static background pattern */
  .static-bg {
    background: 
      radial-gradient(circle at 20% 80%, color-mix(in oklch, var(--primary) 8%, transparent) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, color-mix(in oklch, var(--accent-foreground) 6%, transparent) 0%, transparent 50%),
      radial-gradient(circle at 40% 40%, color-mix(in oklch, var(--additive) 4%, transparent) 0%, transparent 50%);
    background-size: 400px 400px, 300px 300px, 200px 200px;
  }

  /* Subtle glow effect */
  .glow {
    box-shadow: 
      0 0 15px color-mix(in oklch, var(--primary) 15%, transparent),
      0 0 30px color-mix(in oklch, var(--primary) 8%, transparent);
  }

  /* Elegant border effect */
  .elegant-border {
    position: relative;
    border: 1px solid var(--border);
  }
  .elegant-border::before {
    content: '';
    position: absolute;
    inset: -1px;
    background: linear-gradient(45deg, 
      var(--primary), 
      var(--accent-foreground), 
      var(--additive)
    );
    border-radius: inherit;
    z-index: -1;
    opacity: 0.3;
  }

  /* Soft shadow effect */
  .soft-shadow {
    box-shadow: 
      0 2px 8px color-mix(in oklch, var(--foreground) 4%, transparent),
      0 4px 16px color-mix(in oklch, var(--foreground) 2%, transparent);
  }

  /* Static neon border effect */
  .neon-border {
    position: relative;
  }
  .neon-border::after {
    content: '';
    position: absolute;
    inset: -2px;
    background: linear-gradient(45deg, 
      var(--primary), 
      var(--accent-foreground), 
      var(--additive), 
      var(--primary)
    );
    border-radius: inherit;
    z-index: -1;
    opacity: 0.5;
  }

  /* Subtle shimmer effect */
  .shimmer {
    position: relative;
    overflow: hidden;
  }
  .shimmer::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      color-mix(in oklch, var(--foreground) 5%, transparent),
      transparent
    );
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .shimmer:hover::before {
    opacity: 1;
  }

  /* Tôn trọng reduced-motion */
  @media (prefers-reduced-motion: reduce) {
    .card-hover,
    .card-hover:hover,
    .card-hover:active,
    .shimmer,
    .shimmer:hover {
      transition: none;
      transform: none;
    }
  }
}

/* =======================================================
   CODE BLOCKS – Hiển thị full (không cuộn dọc)
   ======================================================= */
.astro-code,
.shiki,
figure[data-rehype-pretty-code-figure] pre {
  max-height: none !important;
  height: auto !important;
  overflow-y: visible !important;
  overflow-x: auto;

  background: linear-gradient(135deg, 
    color-mix(in oklch, var(--card) 98%, var(--primary) 2%),
    color-mix(in oklch, var(--card) 99%, var(--accent-foreground) 1%)
  );
  color: var(--foreground);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1rem 1.25rem;
  box-shadow: 
    0 2px 8px color-mix(in oklch, var(--foreground) 4%, transparent),
    0 0 15px color-mix(in oklch, var(--primary) 3%, transparent);
  width: 100% !important;
  position: relative;
}

.astro-code::before,
.shiki::before,
figure[data-rehype-pretty-code-figure] pre::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, 
    var(--primary), 
    var(--accent-foreground), 
    var(--additive)
  );
  border-radius: var(--radius) var(--radius) 0 0;
}

:not(pre) > code {
  background: color-mix(in oklch, var(--secondary) 70%, transparent);
  padding: .15rem .4rem;
  border-radius: .4rem;
  border: 1px solid var(--border);
  font-family: var(--font-mono);
  font-size: .9em;
}

.astro-code, .shiki, pre, code, kbd, samp {
  font-family: var(--font-mono);
}

pre::-webkit-scrollbar { height: 8px; }
pre::-webkit-scrollbar-thumb { background: var(--muted-foreground); border-radius: 999px; }
pre::-webkit-scrollbar-track { background: transparent; }

.prose pre {
  max-height: none !important;
  overflow-y: visible !important;
}
/* ép code block full height, không cuộn dọc */
.astro-code,
pre,
pre code,
figure[data-rehype-pretty-code-figure] pre {
  max-height: none !important;   /* bỏ giới hạn chiều cao */
  height: auto !important;       /* tự giãn theo content */
  overflow-y: visible !important; /* không cuộn dọc */
  overflow-x: auto;              /* chỉ cho cuộn ngang */
}

/* fix cho prose (markdown) nếu dùng @tailwind typography */
.prose pre {
  max-height: none !important;
  height: auto !important;
  overflow-y: visible !important;
}

/* Đảm bảo tất cả code blocks đều hiển thị full */
.prose :where(pre):not(:where([class~='not-prose'], [class~='not-prose'] *)) {
  max-height: none !important;
  height: auto !important;
  overflow-y: visible !important;
}
